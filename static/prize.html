<!DOCTYPE html>
<html lang="kz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>ZHAD | Сыйлық дөңгелегі</title>

  <style>
    :root{
      --black:#0b0b0c;
      --black-2:#121214;
      --white:#ffffff;
      --muted:#8b8b8d;
      --line:#e9e9ea;
      --gold:#d4af37;
      --gold-2:#f2d678;
      --shadow-1:0 2px 10px rgba(0,0,0,.12);
      --shadow-2:0 10px 40px rgba(0,0,0,.22);
      --shadow-3:0 20px 70px rgba(0,0,0,.28);
    }

    *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
    html,body{height:100%;overflow-x:hidden}
    
    /* ✅ Fixed: Use min-height instead of fixed height to prevent overflow */
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Inter,Arial,sans-serif;
      background: radial-gradient(1200px 1200px at 50% -200px,#151515 0%,#0b0b0c 55%);
      color:var(--white);
      
      /* Use min-height to allow content to expand if needed */
      min-height:var(--tg-viewport-stable-height,100vh);
      
      /* Simplified padding - removed top padding conflicts */
      padding:max(env(safe-area-inset-top), var(--tg-safe-area-inset-top, 0px), 16px) 0 max(env(safe-area-inset-bottom), var(--tg-safe-area-inset-bottom, 0px), 16px);
      
      display:flex;
      align-items:center;
      justify-content:center;
      overflow-y:auto;
    }

    .wrap{
      width:min(92vw,520px);
      padding:10px 16px 28px;
      /* Ensure wrap fits within viewport */
      max-height:100%;
      overflow-y:auto;
    }

    /* Brand section - removed sticky to avoid conflicts */
    .brand{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:14px;
      padding-top:4px;
    }
    
    .logo{
      font-weight:900;letter-spacing:.14em;font-size:13px;color:#fff;
      padding:8px 12px;border:1px solid rgba(255,255,255,.08);
      border-radius:12px;background:rgba(255,255,255,.02)
    }
    .title{
      font-size:clamp(26px,6vw,34px);font-weight:900;letter-spacing:-.02em;line-height:1.1
    }
    .subtitle{color:#c8c8c8;margin-top:6px}

    .lang{
      display:flex;gap:6px;
    }
    .lang button{
      background:rgba(255,255,255,.06);color:#ddd;border:1px solid rgba(255,255,255,.08);
      padding:8px 14px;border-radius:999px;font-weight:700;font-size:12px;cursor:pointer
    }
    .lang button.active{background:#fff;color:#000}

    .stage{margin-top:18px;display:flex;flex-direction:column;align-items:center}
    .wheel-box{
      width:min(86vw,420px);aspect-ratio:1/1;position:relative;filter:drop-shadow(var(--shadow-3));
    }

    /* pointer */
    .pointer{
      position:absolute;left:50%;top:-8px;translate:-50% 0;z-index:6;
      width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;border-top:26px solid #000;
      filter:drop-shadow(0 6px 14px rgba(212,175,55,.35));
    }
    .pointer::after{
      content:'';position:absolute;left:-12px;top:-16px;width:24px;height:24px;border-radius:50%;
      background: radial-gradient(circle at 35% 35%, #fff 0 22%, #0000 23%), #000;
      border:2px solid var(--gold);
      box-shadow:0 0 0 4px rgba(212,175,55,.18), inset 0 0 12px rgba(212,175,55,.35);
    }

    .rim{
      position:absolute;inset:-8px;border-radius:50%;
      background:
        radial-gradient(circle at 50% 50%, rgba(255,255,255,.08) 0 48%, transparent 49%),
        conic-gradient(from 0deg, rgba(255,255,255,.08), rgba(255,255,255,0) 60%),
        linear-gradient(145deg,#8a6f11,#f1d36f 35%,#8a6f11 70%,#f1d36f);
      padding:8px;
      z-index:0;
      box-shadow:inset 0 2px 8px rgba(255,255,255,.06), 0 10px 40px rgba(0,0,0,.35);
    }

    .wheel{
      position:absolute;inset:0;margin:auto;border-radius:50%;background:#101012;
      border:1px solid rgba(255,255,255,.06);overflow:hidden;z-index:1;
      transition:transform 8.6s cubic-bezier(.17,.67,.12,.99);
    }

    /* ticks */
    .ticks{position:absolute;inset:10px;border-radius:50%;pointer-events:none;z-index:4}
    .ticks::before{
      content:'';position:absolute;inset:0;border-radius:50%;
      background:repeating-conic-gradient(from -90deg, rgba(255,255,255,.14) 0 2deg, transparent 2deg 6deg);
      -webkit-mask:radial-gradient(circle, transparent 80%, #000 81%);
              mask:radial-gradient(circle, transparent 80%, #000 81%);
      opacity:.9;
    }

    .hub{
      position:absolute;inset:50% auto auto 50%;translate:-50% -50%;
      width:92px;height:92px;border-radius:50%;
      background:radial-gradient(circle at 35% 35%, #242424 0 50%, #0d0d0f 60%);
      border:2px solid rgba(255,255,255,.08);
      box-shadow:0 10px 30px rgba(0,0,0,.6), inset 0 0 30px rgba(212,175,55,.25);
      z-index:5;display:flex;align-items:center;justify-content:center;
    }
    .hub .mark{font-weight:900;letter-spacing:.18em;font-size:12px;color:#fff}
    .hub::after{
      content:'';position:absolute;inset:12px;border-radius:50%;
      border:1px solid rgba(212,175,55,.6);
      box-shadow:inset 0 0 24px rgba(212,175,55,.35), 0 0 0 6px rgba(212,175,55,.16);
    }

    .spin{
      margin-top:24px;
      background:#fff;color:#000;border:none;padding:16px 26px;border-radius:14px;
      font-weight:900;letter-spacing:.06em;font-size:14px;cursor:pointer;
      box-shadow:var(--shadow-2);transition:transform .12s ease, box-shadow .2s ease;
      min-width:220px;text-transform:uppercase;
    }
    .spin:hover{transform:translateY(-1px)}
    .spin:active{transform:translateY(0)}
    .spin[disabled]{opacity:.65;cursor:not-allowed;position:relative}
    .spin[disabled]::after{
      content:'';position:absolute;inset:0;margin:auto;width:20px;height:20px;border-radius:50%;
      border:2px solid #0000;border-top-color:#000;animation:spin 1s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* modal */
    .modal{
      position:fixed;inset:0;display:none;place-items:center;z-index:20;
      background:rgba(0,0,0,.72);backdrop-filter:blur(10px);
      padding:20px;
    }
    .modal.show{display:grid}
    .card{
      width:min(92vw,460px);
      background:linear-gradient(180deg,#111214,#0b0b0c);
      border:1px solid rgba(255,255,255,.08);
      border-radius:22px;padding:28px 22px 22px;text-align:center;
      box-shadow:var(--shadow-3); position:relative; overflow:hidden;
      animation:rise .5s ease both;
    }
    @keyframes rise{from{opacity:0;transform:translateY(12px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}
    .shine{
      position:absolute;inset:-40%;background:conic-gradient(from 0deg,transparent,rgba(255,255,255,.06),transparent 60%);
      animation:rotateShine 3.5s linear infinite;pointer-events:none
    }
    @keyframes rotateShine{to{transform:rotate(360deg)}}

    .win-icon{
      width:96px;height:96px;margin:6px auto 14px;border-radius:50%;
      display:grid;place-items:center;background:#fff;
      border:3px solid var(--gold);box-shadow:0 10px 30px rgba(212,175,55,.35), inset 0 0 25px rgba(212,175,55,.25);
      overflow:visible;
      transition:all 0.3s ease;
    }
    .win-icon svg{width:64px;height:64px}
    .win-title{
      font-size:22px;font-weight:900;letter-spacing:.02em; margin-bottom:8px
    }
    .win-sub{color:#cfcfcf;margin-bottom:16px;font-size:15px}
    .pill{
      display:inline-flex;align-items:center;gap:10px;
      padding:12px 18px;border-radius:999px;background:#111214;border:1px solid rgba(255,255,255,.08);
      color:#fff;font-weight:800;font-size:15px;
    }
    .pill::before{
      font-size:24px;
    }
    .ok{
      margin-top:18px;width:100%;padding:14px;border-radius:14px;border:none;cursor:pointer;
      background:#fff;color:#000;font-weight:900;letter-spacing:.06em;text-transform:uppercase;
      box-shadow:var(--shadow-2)
    }

    /* confetti */
    .confetti{
      position:fixed;top:-10px;width:10px;height:10px;border-radius:2px;pointer-events:none;z-index:30
    }

    /* small screens */
    @media (max-width:480px){
      .hub{width:82px;height:82px}
      .wheel-box{width:min(90vw,420px)}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="brand">
      <div class="logo">ZHAD</div>
      <div class="lang">
        <button class="lang-btn" data-lang="ru">RU</button>
        <button class="lang-btn active" data-lang="kz">KZ</button>
      </div>
    </div>

    <h1 class="title" data-i18n="title">Сыйлық дөңгелегі</h1>
    <p class="subtitle" data-i18n="subtitle">4 сыйлықтың біріне ие болыңыз!</p>

    <div class="stage">
      <div class="wheel-box">
        <div class="pointer"></div>
        <div class="rim"></div>
        <svg class="wheel" id="wheel" viewBox="0 0 400 400" aria-label="Prize wheel">
          <!-- slices generated by JS -->
        </svg>
        <div class="ticks"></div>
        <div class="hub"><span class="mark">ZHAD</span></div>
      </div>

      <button class="spin" id="spinBtn" data-i18n="spin">Айналдыру</button>
    </div>
  </div>

  <!-- Winner modal -->
  <div class="modal" id="winModal" role="dialog" aria-modal="true" aria-labelledby="winTitle">
    <div class="card">
      <div class="shine"></div>
      <div class="win-icon" id="winIcon"></div>
      <h2 class="win-title" id="winTitle" data-i18n="congrats">Құттықтаймыз!</h2>
      <p class="win-sub" id="winText">Сіз сыйлық ұттыңыз!</p>
      <div class="pill" id="winPill"><span id="winPillText">Prize</span></div>
      <button class="ok" id="closeModal" data-i18n="close">Жабу</button>
    </div>
  </div>

  <script>
    /* =========================
      i18n - ✅ FIXED: Proper language for each prize
    ========================== */
    const i18n = {
      ru:{
        title:"Колесо призов",
        subtitle:"Выиграйте один из 4 призов!",
        spin:"Крутить",
        spinning:"Крутится...",
        congrats:"Поздравляем!",
        close:"Закрыть",
        prizes:{
          parfum10:"🧪 10мл парфюм",
          parfum30:"🧪 30мл парфюм",
          diamond_ring:"💍 Кольцо",
          money:"💵 100 000 ₸"
        },
        prizesWin:{
          parfum10:"🧪 10мл парфюм",
          parfum30:"🧪 30мл парфюм",
          diamond_ring:"💍 Бриллиантовое кольцо",
          money:"💵 100 000 тенге"
        }
      },
      kz:{
        title:"Сыйлық дөңгелегі",
        subtitle:"4 сыйлықтың біріне ие болыңыз!",
        spin:"Айналдыру",
        spinning:"Айналуда...",
        congrats:"Құттықтаймыз!",
        close:"Жабу",
        prizes:{
          parfum10:"🧪 10мл парфюм",
          parfum30:"🧪 30мл парфюм",
          diamond_ring:"💍 Сақина",
          money:"💵 100 000 ₸"
        },
        prizesWin:{
          parfum10:"🧪 10мл парфюм",
          parfum30:"🧪 30мл парфюм",
          diamond_ring:"Бриллиант сақина",
          money:"💵 100 000 теңге"
        }
      }
    };
    let lang = "kz";

    /* =========================
      Prize model (colors + icon type + emoji)
    ========================== */
    const PRIZES = [
      { id:"parfum10",     bg:"#111214", fg:"#ffffff", accent:"#f2f2f2", icon:"bottle10", emoji:"🌸" },
      { id:"diamond_ring", bg:"#000000", fg:"#ffffff", accent:"#d4af37", icon:"ring",     emoji:"💍" },
      { id:"parfum30",     bg:"#1a1b1e", fg:"#ffffff", accent:"#e6e6e6", icon:"bottle30", emoji:"🌸" },
      { id:"money",        bg:"#000000", fg:"#ffffff", accent:"#f2d678", icon:"money",    emoji:"💰" }
    ];

    const wheel   = document.getElementById('wheel');
    const spinBtn = document.getElementById('spinBtn');

    let isSpinning = false;
    let currentRotation = 0;

    /* =========================
      Build premium-looking slices with SVG
    ========================== */
    function buildWheel(){
      const slices = PRIZES.length;
      const center = 200, R = 190, rIcon = 115;

      wheel.innerHTML = "";

      PRIZES.forEach((p, i) => {
        const a0 = (360/slices)*i - 90;
        const a1 = (360/slices)*(i+1) - 90;
        const largeArc = (a1 - a0) > 180 ? 1 : 0;

        const x0 = center + R*Math.cos(rad(a0));
        const y0 = center + R*Math.sin(rad(a0));
        const x1 = center + R*Math.cos(rad(a1));
        const y1 = center + R*Math.sin(rad(a1));

        // segment
        const path = document.createElementNS("http://www.w3.org/2000/svg","path");
        path.setAttribute("d", `M ${center} ${center} L ${x0} ${y0} A ${R} ${R} 0 ${largeArc} 1 ${x1} ${y1} Z`);
        path.setAttribute("fill", p.bg);
        path.setAttribute("stroke", "rgba(255,255,255,.08)");
        path.setAttribute("stroke-width", "1");
        wheel.appendChild(path);

        // subtle gloss
        const gloss = document.createElementNS("http://www.w3.org/2000/svg","path");
        gloss.setAttribute("d", `M ${center} ${center} L ${x0} ${y0} A ${R} ${R} 0 ${largeArc} 1 ${x1} ${y1} Z`);
        gloss.setAttribute("fill", "url(#gloss)");
        gloss.setAttribute("opacity", ".18");
        wheel.appendChild(gloss);

        // icon + label group
        const mid = a0 + (a1-a0)/2;
        const ix = center + rIcon*Math.cos(rad(mid));
        const iy = center + rIcon*Math.sin(rad(mid));

        const g = document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("transform", `translate(${ix},${iy}) rotate(${mid+90})`);
        wheel.appendChild(g);

        // logo plate
        const plate = document.createElementNS("http://www.w3.org/2000/svg","rect");
        plate.setAttribute("x", -28); plate.setAttribute("y", -28);
        plate.setAttribute("width", 56); plate.setAttribute("height", 56);
        plate.setAttribute("rx", 12);
        plate.setAttribute("fill", "#0f1013");
        plate.setAttribute("stroke", p.accent);
        plate.setAttribute("stroke-width", "1.5");
        g.appendChild(plate);

        // logo icon
        g.appendChild(makeIcon(p.icon, p.fg, p.accent));

        // label (below plate)
        const label = document.createElementNS("http://www.w3.org/2000/svg","text");
        label.setAttribute("x", 0);
        label.setAttribute("y", 44);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "12");
        label.setAttribute("font-weight", "900");
        label.setAttribute("fill", "#e9e9ea");
        label.textContent = i18n[lang].prizes[p.id];
        g.appendChild(label);
      });

      // defs for gloss
      const defs = document.createElementNS("http://www.w3.org/2000/svg","defs");
      const lg = document.createElementNS("http://www.w3.org/2000/svg","linearGradient");
      lg.setAttribute("id","gloss");
      lg.setAttribute("x1","0"); lg.setAttribute("x2","0");
      lg.setAttribute("y1","0"); lg.setAttribute("y2","1");
      const s1 = document.createElementNS("http://www.w3.org/2000/svg","stop");
      s1.setAttribute("offset","0%"); s1.setAttribute("stop-color","#fff"); s1.setAttribute("stop-opacity",".08");
      const s2 = document.createElementNS("http://www.w3.org/2000/svg","stop");
      s2.setAttribute("offset","100%"); s2.setAttribute("stop-color","#000"); s2.setAttribute("stop-opacity","0");
      lg.appendChild(s1); lg.appendChild(s2);
      defs.appendChild(lg);
      wheel.appendChild(defs);
    }

    function rad(deg){return deg*Math.PI/180}

    /* =========================
      Icons (wheel + win modal share this)
    ========================== */
    function makeIcon(kind, color="#fff", accent="#d4af37"){
      const g = document.createElementNS("http://www.w3.org/2000/svg","g");
      if(kind.includes("bottle")){
        // bottle base
        const rect = document.createElementNS("http://www.w3.org/2000/svg","rect");
        rect.setAttribute("x",-14); rect.setAttribute("y",-8); rect.setAttribute("width",28); rect.setAttribute("height",24);
        rect.setAttribute("rx",4); rect.setAttribute("fill", color);
        g.appendChild(rect);
        // neck
        const neck = document.createElementNS("http://www.w3.org/2000/svg","rect");
        neck.setAttribute("x",-6); neck.setAttribute("y",-16); neck.setAttribute("width",12); neck.setAttribute("height",8);
        neck.setAttribute("rx",2); neck.setAttribute("fill", color);
        g.appendChild(neck);
        // cap
        const cap = document.createElementNS("http://www.w3.org/2000/svg","rect");
        cap.setAttribute("x",-10); cap.setAttribute("y",-22); cap.setAttribute("width",20); cap.setAttribute("height",6);
        cap.setAttribute("rx",3); cap.setAttribute("fill", color);
        g.appendChild(cap);
        // label
        const label = document.createElementNS("http://www.w3.org/2000/svg","rect");
        label.setAttribute("x",-9); label.setAttribute("y",-1); label.setAttribute("width",18); label.setAttribute("height",12);
        label.setAttribute("rx",2); label.setAttribute("fill","#0f1013");
        label.setAttribute("stroke",accent); label.setAttribute("stroke-width","1.2");
        g.appendChild(label);
        // ml text
        const t = document.createElementNS("http://www.w3.org/2000/svg","text");
        t.setAttribute("x",0); t.setAttribute("y",8); t.setAttribute("text-anchor","middle");
        t.setAttribute("font-size","8"); t.setAttribute("font-weight","900"); t.setAttribute("fill",accent);
        t.textContent = kind === "bottle10" ? "10ml" : "30ml";
        g.appendChild(t);
      } else if(kind==="ring"){
        // diamond ring (обруч + камень)
        const ring = document.createElementNS("http://www.w3.org/2000/svg","circle");
        ring.setAttribute("cx","0"); ring.setAttribute("cy","8"); ring.setAttribute("r","14");
        ring.setAttribute("fill","#121214");
        ring.setAttribute("stroke",accent); ring.setAttribute("stroke-width","2.5");
        g.appendChild(ring);
        const stone = document.createElementNS("http://www.w3.org/2000/svg","polygon");
        stone.setAttribute("points","0,-14 10,-4 0,6 -10,-4");
        stone.setAttribute("fill","#0f1013");
        stone.setAttribute("stroke",accent); stone.setAttribute("stroke-width","2");
        g.appendChild(stone);
        const shine = document.createElementNS("http://www.w3.org/2000/svg","line");
        shine.setAttribute("x1","0"); shine.setAttribute("y1","-18");
        shine.setAttribute("x2","0"); shine.setAttribute("y2","-24");
        shine.setAttribute("stroke",accent); shine.setAttribute("stroke-width","2");
        g.appendChild(shine);
      } else if(kind==="money"){
        const coin = document.createElementNS("http://www.w3.org/2000/svg","circle");
        coin.setAttribute("cx","0"); coin.setAttribute("cy","0"); coin.setAttribute("r","18");
        coin.setAttribute("fill","#1a1b1e");
        coin.setAttribute("stroke",accent); coin.setAttribute("stroke-width","2");
        g.appendChild(coin);
        const t = document.createElementNS("http://www.w3.org/2000/svg","text");
        t.setAttribute("x",0); t.setAttribute("y",5); t.setAttribute("text-anchor","middle");
        t.setAttribute("font-size","18"); t.setAttribute("font-weight","900"); t.setAttribute("fill",accent);
        t.textContent = "₸";
        g.appendChild(t);
      }
      return g;
    }

    function makeSVGIcon(kind, color, accent){
      const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
      svg.setAttribute("viewBox","-32 -32 64 64");
      svg.setAttribute("aria-hidden","true");
      svg.appendChild(makeIcon(kind, color, accent));
      return svg;
    }

    /* =========================
      Spin logic (deterministic winner, premium easing)
    ========================== */
    function spin(){
      if(isSpinning) return;
      isSpinning = true;
      spinBtn.disabled = true;
      spinBtn.textContent = i18n[lang].spinning;

      // pick a winner index
      const idx = Math.floor(Math.random() * PRIZES.length);

      // slice angle and target angle so pointer (top) hits center of winning slice
      const slice = 360 / PRIZES.length;
      const targetFromTop = (idx * slice) + slice/2;  // degrees clockwise from 0
      const base = 360 * (6 + Math.floor(Math.random()*3)); // full spins 6..8
      const final = base + (360 - targetFromTop);

      currentRotation += final;

      // nice multi-phase feel: quick accel then long ease
      wheel.style.transition = 'transform 0.6s cubic-bezier(.25,.46,.45,.94)';
      wheel.style.transform = `rotate(${currentRotation - final*0.7}deg)`;
      setTimeout(()=>{
        wheel.style.transition = 'transform 6.5s cubic-bezier(.17,.67,.12,.99)';
        wheel.style.transform = `rotate(${currentRotation}deg)`;
      }, 80);

      // announce winner near end
      setTimeout(()=>{
        const prize = PRIZES[idx];
        showWin(prize);
        isSpinning = false;
        spinBtn.disabled = false;
        spinBtn.textContent = i18n[lang].spin;
      }, 7000 + 350); // align with animation
    }

    /* =========================
      Winner modal + confetti
    ========================== */
    const winModal = document.getElementById('winModal');
    const winIcon  = document.getElementById('winIcon');
    const winText  = document.getElementById('winText');
    const winPill  = document.getElementById('winPillText');
    document.getElementById('closeModal').addEventListener('click', ()=> winModal.classList.remove('show'));
    winModal.addEventListener('click', (e)=>{ if(e.target === winModal) winModal.classList.remove('show'); });

    function showWin(prize){
      const label = i18n[lang].prizes[prize.id];

      // set proper SVG logo for the won prize
      winIcon.innerHTML = ""; // clear
      winIcon.appendChild(makeSVGIcon(prize.icon, "#000", prize.accent));

      document.querySelector('[data-i18n="congrats"]').textContent = i18n[lang].congrats;
      winText.textContent = (lang==="kz" ? "Сіз ұттыңыз: " : "Вы выиграли: ") + label + "!";
      winPill.textContent = label;

      winModal.classList.add('show');
      burstConfetti();
    }

    function burstConfetti(prizeAccent = '#d4af37'){
      // ✅ Match confetti colors to prize accent
      const cols = ['#ffffff','#f2f2f2','#bdbdbd', prizeAccent, '#0b0b0c'];
      const N = 140;
      for(let i=0;i<N;i++){
        setTimeout(()=>{
          const el = document.createElement('div');
          el.className = 'confetti';
          el.style.left = Math.random()*100 + 'vw';
          el.style.background = cols[Math.floor(Math.random()*cols.length)];
          el.style.transform = `rotate(${Math.random()*360}deg)`;
          el.style.borderRadius = Math.random()>.6 ? '50%' : '2px';
          document.body.appendChild(el);
          const duration = 2000 + Math.random()*2200;
          el.animate([
            { transform:`translateY(-10px) rotate(0deg) scale(1)`, opacity:1 },
            { transform:`translateY(${window.innerHeight + 120}px) rotate(${360+Math.random()*720}deg) scale(${.5+Math.random()*.5})`, opacity:0 }
          ], { duration, easing:'cubic-bezier(.25,.46,.45,.94)' }).onfinish = ()=> el.remove();
        }, i*12);
      }
    }

    /* =========================
      Language switch
    ========================== */
    document.querySelectorAll('.lang-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.lang-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        lang = btn.dataset.lang;
        applyI18n();
        buildWheel();
      });
    });

    function applyI18n(){
      document.querySelector('[data-i18n="title"]').textContent = i18n[lang].title;
      document.querySelector('[data-i18n="subtitle"]').textContent = i18n[lang].subtitle;
      document.querySelector('[data-i18n="spin"]').textContent = i18n[lang].spin;
      document.querySelector('[data-i18n="close"]').textContent = i18n[lang].close;
      document.querySelector('[data-i18n="congrats"]').textContent = i18n[lang].congrats;
    }

    /* =========================
      Telegram WebApp safe viewport - ✅ FIXED viewport handling
    ========================== */
    if(window.Telegram && Telegram.WebApp){
      const tg = Telegram.WebApp;
      tg.ready(); 
      tg.expand();
      
      try {
        tg.setHeaderColor('#0b0b0c'); 
        tg.setBackgroundColor('#0b0b0c');
      } catch(e) {}
      
      // Update height on viewport changes
      function updateHeight() {
        const vh = tg.viewportStableHeight || window.innerHeight;
        document.documentElement.style.setProperty('--tg-viewport-stable-height', `${vh}px`);
        document.body.style.minHeight = `${vh}px`;
      }
      
      updateHeight();
      tg.onEvent('viewportChanged', updateHeight);
    }

    /* =========================
      Bind + init
    ========================== */
    spinBtn.addEventListener('click', spin);
    applyI18n();
    buildWheel();

    // helpers
    document.addEventListener('contextmenu', e=>e.preventDefault(), {passive:false});
    let lastTouchEnd=0;
    document.addEventListener('touchend', e=>{
      const now=Date.now(); if(now-lastTouchEnd<=300) e.preventDefault(); lastTouchEnd=now;
    }, {passive:false});
  </script>
</body>
</html>